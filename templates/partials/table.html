<div class="controls" style="margin: 1rem 0;">
    <input type="text" onkeyup="filterTable(this)" placeholder="Filter by title or author..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; box-sizing: border-box;">
</div>

<div style="overflow-x: hidden; border: 1px solid #eee; border-radius: 4px;">
    <table id="archiveTable" style="width: 100%; table-layout: fixed;">
        <thead>
            <tr>
                <th onclick="sortTable(0, 'date')" style="width: 90px; padding: 8px;">Date ↕</th>
                
                <th class="hide-on-mobile" onclick="sortTable(1, 'number')" style="width: 50px; text-align: right; padding: 8px;">Ups ↕</th>
                <th class="hide-on-mobile" onclick="sortTable(2, 'number')" style="width: 50px; text-align: right; padding: 8px;">Cmt ↕</th>
                
                <th onclick="sortTable(3, 'string')" style="width: auto; padding: 8px;">Title ↕</th>
                
                <th class="hide-on-mobile" onclick="sortTable(4, 'string')" style="width: 120px; padding: 8px;">Author ↕</th>
            </tr>
        </thead>
        <tbody>
        {% for p in latest_pages %}
            {% if not p.extra.author %}{% continue %}{% endif %}
            <tr style="border-bottom: 1px solid #f5f5f5;">
                <td data-value="{{ p.date }}" style="padding: 8px; font-size: 0.85em; color: #666; line-height: 1.2; vertical-align: top;">
                    {{ p.date | date(format="%Y-%m-%d") }}<br>
                    <span style="font-size: 0.85em; opacity: 0.7;">{{ p.date | date(format="%H:%M") }}</span>
                </td>
                
                <td class="hide-on-mobile" data-value="{{ p.extra.ups | default(value=0) }}" style="padding: 8px; text-align: right; font-family: monospace; vertical-align: top;">
                    {{ p.extra.ups | default(value=0) }}
                </td>

                <td class="hide-on-mobile" data-value="{{ p.extra.num_comments | default(value=0) }}" style="padding: 8px; text-align: right; font-family: monospace; vertical-align: top;">
                    {{ p.extra.num_comments | default(value=0) }}
                </td>

                <td data-value="{{ p.title }}" style="padding: 8px; vertical-align: top; overflow: hidden;">
                    <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        <a href="{{ p.permalink }}" style="font-weight: 500; color: #2244cc; text-decoration: none;">{{ p.title }}</a>
                    </div>
                    {% if p.extra.flair %}
                    <div style="margin-top: 2px;">
                        <span style="font-size: 0.75em; background: #f0f0f5; color: #667; padding: 1px 5px; border-radius: 4px;">
                            {{ p.extra.flair }}
                        </span>
                    </div>
                    {% endif %}
                </td>

                <td class="hide-on-mobile" data-value="{{ p.extra.author }}" style="padding: 8px; font-size: 0.9em; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: top;">
                    {{ p.extra.author }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<style>
    @media (max-width: 600px) {
        .hide-on-mobile { display: none; }
        th, td { padding: 6px 4px !important; }
    }
</style>

<script>
    function filterTable(input) {
        const filter = input.value.toLowerCase();
        const rows = document.querySelectorAll('#archiveTable tbody tr');
        rows.forEach(row => {
            const title = row.cells[3].textContent.toLowerCase();
            const authorCell = row.cells[4];
            const author = authorCell ? authorCell.textContent.toLowerCase() : "";
            
            if (title.includes(filter) || author.includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    let sortDir = 1;
    function sortTable(colIndex, type) {
        const table = document.getElementById("archiveTable");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        sortDir *= -1;
        rows.sort((a, b) => {
            const valA = a.cells[colIndex].getAttribute('data-value');
            const valB = b.cells[colIndex].getAttribute('data-value');
            if (type === 'number') return (parseFloat(valA) - parseFloat(valB)) * sortDir;
            return valA.localeCompare(valB) * sortDir;
        });
        rows.forEach(row => tbody.appendChild(row));
    }
</script>
