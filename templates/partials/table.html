<div style="min-width: 600px;">
    <table id="archiveTable">
        <thead>
            <tr>
                <th onclick="sortTable(0, 'date')" style="width: 15%;">Date ↕</th>
                <th class="hide-on-mobile" onclick="sortTable(1, 'number')" style="width: 8%; text-align: right;">Ups ↕</th>
                <th class="hide-on-mobile" onclick="sortTable(2, 'number')" style="width: 8%; text-align: right;">Cmt ↕</th>
                <th onclick="sortTable(3, 'string')" style="width: auto;">Title ↕</th>
                <th onclick="sortTable(4, 'string')" style="width: 20%;">Author ↕</th>
            </tr>
        </thead>
        <tbody>
        {% for p in latest_pages %}
            {% if not p.extra.author %}{% continue %}{% endif %}

            <tr>
                <td data-value="{{ p.date }}" style="font-size: 0.85em; color: #666; line-height: 1.2;">
                    {{ p.date | date(format="%Y-%m-%d") }}<br>
                    <span style="font-size: 0.85em; opacity: 0.7;">{{ p.date | date(format="%H:%M") }}</span>
                </td>
                
                <td class="hide-on-mobile" data-value="{{ p.extra.ups | default(value=0) }}" style="text-align: right; font-family: monospace;">
                    {{ p.extra.ups | default(value=0) }}
                </td>

                <td class="hide-on-mobile" data-value="{{ p.extra.num_comments | default(value=0) }}" style="text-align: right; font-family: monospace;">
                    {{ p.extra.num_comments | default(value=0) }}
                </td>

                <td data-value="{{ p.title }}">
                    <a href="{{ p.permalink }}" style="font-weight: 500; display: block; margin-bottom: 2px;">{{ p.title }}</a>
                    {% if p.extra.flair %}
                        <span style="font-size: 0.75em; background: #f0f0f5; color: #556; padding: 1px 5px; border-radius: 4px; display: inline-block;">
                            {{ p.extra.flair }}
                        </span>
                    {% endif %}
                </td>

                <td data-value="{{ p.extra.author }}" style="font-size: 0.9em; color: #555; overflow: hidden; text-overflow: ellipsis;">
                    {{ p.extra.author }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<style>
    @media (max-width: 600px) {
        .hide-on-mobile { display: none; }
        th:nth-child(4), td:nth-child(4) { width: auto; } 
    }
</style>

<script>
    function filterTable(input) {
        const filter = input.value.toLowerCase();
        const rows = document.querySelectorAll('#archiveTable tbody tr');
        rows.forEach(row => {
            const title = row.cells[3].textContent.toLowerCase();
            const author = row.cells[4].textContent.toLowerCase();
            row.style.display = (title.includes(filter) || author.includes(filter)) ? '' : 'none';
        });
    }

    let sortDir = 1;
    function sortTable(colIndex, type) {
        const table = document.getElementById("archiveTable");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        sortDir *= -1;
        rows.sort((a, b) => {
            const valA = a.cells[colIndex].getAttribute('data-value');
            const valB = b.cells[colIndex].getAttribute('data-value');
            if (type === 'number') return (parseFloat(valA) - parseFloat(valB)) * sortDir;
            return valA.localeCompare(valB) * sortDir;
        });
        rows.forEach(row => tbody.appendChild(row));
    }
</script>
